document.addEventListener("DOMContentLoaded", () => {
    const addUserBtn = document.getElementById("add-user-btn");
    const listUsersBtn = document.getElementById("list-users-btn");
    const addUserSection = document.getElementById("add-user-section");
    const listUsersSection = document.getElementById("list-users-section");
    const addUserForm = document.getElementById("add-user-form");
    const usersList = document.getElementById("users-list");
    const addUserMessage = document.getElementById("add-user-message");

    // Toggle sections
    addUserBtn.addEventListener("click", () => {
        addUserSection.classList.remove("hidden");
        listUsersSection.classList.add("hidden");
    });

    listUsersBtn.addEventListener("click", () => {
        addUserSection.classList.add("hidden");
        listUsersSection.classList.remove("hidden");
        fetchUsers();
    });

    // Add user
    addUserForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(addUserForm);
        const user = {
            name: formData.get("name"),
            email: formData.get("email"),
            password: formData.get("password"),
            role: formData.get("role"),
        };

        const response = await fetch("/api/users", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(user),
        });

        if (response.ok) {
            addUserMessage.textContent = "User added successfully!";
            addUserMessage.classList.add("success");
            addUserForm.reset();
        } else {
            addUserMessage.textContent = "Failed to add user.";
            addUserMessage.classList.add("error");
        }
    });

    // Fetch users
    async function fetchUsers() {
        const response = await fetch("/api/users");
        const users = await response.json();

        usersList.innerHTML = ""; // Clear previous list
        if (users.length === 0) {
            usersList.textContent = "No users found.";
        } else {
            users.forEach((user) => {
                const userDiv = document.createElement("div");
                userDiv.innerHTML = `
                    <p><strong>ID:</strong> ${user.id}</p>
                    <p><strong>Name:</strong> ${user.name}</p>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>Role:</strong> ${user.role}</p>
                    <hr>
                `;
                usersList.appendChild(userDiv);
            });
        }
    }
});
